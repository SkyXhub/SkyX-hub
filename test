--[[
üåä SkyX Hub - Dead Rails üåä
Lightweight loader with Orion UI
]]

-- Game check
if game.PlaceId ~= 6729832410 and game.PlaceId ~= 12355337193 then
    warn("This script is only for Dead Rails. Please execute in Dead Rails.")
    return
end

-- Core services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")

-- Device detection
local IsMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled
local DeviceText = IsMobile and "Mobile" or "PC"

print("SkyX Dead Rails - Starting on " .. DeviceText .. " device")

-- Prevent multiple execution
if _G.SkyXDeadRailsLoaded then
    warn("SkyX Dead Rails is already running!")
    return
end
_G.SkyXDeadRailsLoaded = true

-- Send notification function
local function Notify(title, text, duration)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title or "SkyX Hub",
        Text = text or "Script is running!",
        Duration = duration or 5
    })
end

Notify("SkyX Hub", "Loading Dead Rails...", 3)

-- GitHub Module URLs
local ModuleURLs = {
    ESP = "https://raw.githubusercontent.com/SkyXhub/modularsystem.lua/main/deadrails_esp.lua",
    GunMods = "https://raw.githubusercontent.com/SkyXhub/modularsystem.lua/main/deadrails_gunmods.lua",
    Aimbot = "https://raw.githubusercontent.com/SkyXhub/modularsystem.lua/main/deadrails_aimbot.lua",
    Teleport = "https://raw.githubusercontent.com/SkyXhub/modularsystem.lua/main/deadrails_teleport%20(1).lua",
    AntiDetect = "https://raw.githubusercontent.com/SkyXhub/modularsystem.lua/main/deadrails_antidetect.lua",
    AutoFarm = "https://raw.githubusercontent.com/SkyXhub/modularsystem.lua/main/deadrails_autofarm.lua"
}

-- Loaded modules
local Modules = {}

-- Load a module from URL with error handling
local function LoadModule(moduleName)
    local url = ModuleURLs[moduleName]
    if not url then
        warn("No URL found for module: " .. moduleName)
        return nil
    end
    
    local success, result = pcall(function()
        return loadstring(game:HttpGet(url))()
    end)
    
    if success then
        print("‚úÖ Successfully loaded: " .. moduleName)
        return result
    else
        warn("‚ùå Failed to load: " .. moduleName .. " | Error: " .. tostring(result))
        
        -- Return dummy module to prevent nil errors
        return {
            Initialize = function() return true end,
            Stop = function() end,
            SetEnabled = function(value) end
        }
    end
end

-- Load Orion UI
local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/jensonhirst/Orion/main/source')))()
if not OrionLib then
    warn("Failed to load Orion Library!")
    return
end

-- Create main window with optimized settings
local Window = OrionLib:MakeWindow({
    Name = "SkyX Hub - Dead Rails", 
    HidePremium = true, 
    SaveConfig = false, 
    ConfigFolder = "SkyXDeadRails",
    IntroEnabled = false, -- Disable intro for faster loading
    Icon = "rbxassetid://10723415903"
})

Notify("SkyX Hub", "Loading modules...", 3)

-- Start loading and initializing modules
Modules.AntiDetect = LoadModule("AntiDetect")
if Modules.AntiDetect and Modules.AntiDetect.Initialize then 
    pcall(function() Modules.AntiDetect.Initialize() end)
end

Modules.ESP = LoadModule("ESP")
if Modules.ESP and Modules.ESP.Initialize then 
    pcall(function() Modules.ESP.Initialize() end)
end

Modules.GunMods = LoadModule("GunMods")
if Modules.GunMods and Modules.GunMods.Initialize then 
    pcall(function() Modules.GunMods.Initialize() end)
end

Modules.Aimbot = LoadModule("Aimbot")
if Modules.Aimbot and Modules.Aimbot.Initialize then 
    pcall(function() Modules.Aimbot.Initialize() end)
end

Modules.Teleport = LoadModule("Teleport")
if Modules.Teleport and Modules.Teleport.Initialize then 
    pcall(function() Modules.Teleport.Initialize() end)
end

Modules.AutoFarm = LoadModule("AutoFarm")
if Modules.AutoFarm and Modules.AutoFarm.Initialize then 
    pcall(function() Modules.AutoFarm.Initialize() end)
end

-- Create Main Tab
local MainTab = Window:MakeTab({
    Name = "Main",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Create a main features section
local MainSection = MainTab:AddSection({
    Name = "Main Features"
})

-- Add unlock guns button
MainSection:AddButton({
    Name = "Unlock All Guns",
    Callback = function()
        if Modules.GunMods and Modules.GunMods.UnlockAllGuns then
            local success = Modules.GunMods.UnlockAllGuns()
            Notify("SkyX Hub", success and "All guns unlocked!" or "Failed to unlock guns", 3)
        end
    end
})

-- Add max ammo button
MainSection:AddButton({
    Name = "Max Ammo (Current Weapon)",
    Callback = function()
        if Modules.GunMods and Modules.GunMods.MaxAmmoCurrentWeapon then
            local success = Modules.GunMods.MaxAmmoCurrentWeapon()
            Notify("SkyX Hub", success and "Ammo maximized!" or "No weapon equipped", 3)
        end
    end
})

-- Auto Farm Section
local AutoFarmSection = MainTab:AddSection({
    Name = "Auto Farm"
})

-- Auto round end toggle
AutoFarmSection:AddToggle({
    Name = "Auto Round End",
    Default = false,
    Callback = function(Value)
        if Modules.AutoFarm and Modules.AutoFarm.SetAutoEnd then
            Modules.AutoFarm.SetAutoEnd(Value)
        end
    end
})

-- Auto bone farm toggle
AutoFarmSection:AddToggle({
    Name = "Auto Bone Farm",
    Default = false,
    Callback = function(Value)
        if Modules.AutoFarm and Modules.AutoFarm.SetAutoBone then
            Modules.AutoFarm.SetAutoBone(Value)
        end
    end
})

-- Create Visuals Tab
local VisualsTab = Window:MakeTab({
    Name = "Visuals",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- ESP section
local ESPSection = VisualsTab:AddSection({
    Name = "ESP"
})

-- Toggle ESP
ESPSection:AddToggle({
    Name = "Enable ESP",
    Default = false,
    Callback = function(Value)
        if Modules.ESP and Modules.ESP.SetEnabled then
            Modules.ESP.SetEnabled(Value)
        end
    end
})

-- ESP Settings
ESPSection:AddToggle({
    Name = "Show Names",
    Default = true,
    Callback = function(Value)
        if Modules.ESP and Modules.ESP.SetShowNames then
            Modules.ESP.SetShowNames(Value)
        end
    end
})

ESPSection:AddToggle({
    Name = "Show Distance",
    Default = true,
    Callback = function(Value)
        if Modules.ESP and Modules.ESP.SetShowDistance then
            Modules.ESP.SetShowDistance(Value)
        end
    end
})

ESPSection:AddToggle({
    Name = "Team Check",
    Default = true,
    Callback = function(Value)
        if Modules.ESP and Modules.ESP.SetTeamCheck then
            Modules.ESP.SetTeamCheck(Value)
        end
    end
})

-- Create Gun Mods Tab
local GunModsTab = Window:MakeTab({
    Name = "Gun Mods",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Gun Mods Section
local GunModsSection = GunModsTab:AddSection({
    Name = "Weapon Modifications"
})

-- Gun mod toggles
GunModsSection:AddToggle({
    Name = "No Recoil",
    Default = false,
    Callback = function(Value)
        if Modules.GunMods and Modules.GunMods.SetNoRecoil then
            Modules.GunMods.SetNoRecoil(Value)
        end
    end
})

GunModsSection:AddToggle({
    Name = "No Spread",
    Default = false,
    Callback = function(Value)
        if Modules.GunMods and Modules.GunMods.SetNoSpread then
            Modules.GunMods.SetNoSpread(Value)
        end
    end
})

GunModsSection:AddToggle({
    Name = "Rapid Fire",
    Default = false,
    Callback = function(Value)
        if Modules.GunMods and Modules.GunMods.SetRapidFire then
            Modules.GunMods.SetRapidFire(Value)
        end
    end
})

GunModsSection:AddToggle({
    Name = "Instant Reload",
    Default = false,
    Callback = function(Value)
        if Modules.GunMods and Modules.GunMods.SetInstantReload then
            Modules.GunMods.SetInstantReload(Value)
        end
    end
})

GunModsSection:AddToggle({
    Name = "Infinite Ammo",
    Default = false,
    Callback = function(Value)
        if Modules.GunMods and Modules.GunMods.SetInfiniteAmmo then
            Modules.GunMods.SetInfiniteAmmo(Value)
        end
    end
})

-- Create Player Tab
local PlayerTab = Window:MakeTab({
    Name = "Player",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Movement Section
local MovementSection = PlayerTab:AddSection({
    Name = "Movement"
})

-- Speed slider
MovementSection:AddSlider({
    Name = "Walk Speed",
    Min = 16,
    Max = 250,
    Default = 16,
    Color = Color3.fromRGB(30, 144, 255),
    Increment = 5,
    ValueName = "speed",
    Callback = function(Value)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = Value
        end
        
        -- Keep applying speed on respawn
        _G.SelectedWalkSpeed = Value
    end    
})

-- Jump power slider
MovementSection:AddSlider({
    Name = "Jump Power",
    Min = 50,
    Max = 300,
    Default = 50,
    Color = Color3.fromRGB(30, 144, 255),
    Increment = 10,
    ValueName = "power",
    Callback = function(Value)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.JumpPower = Value
        end
        
        -- Keep applying jump power on respawn
        _G.SelectedJumpPower = Value
    end    
})

-- Fly section
local FlySection = PlayerTab:AddSection({
    Name = "Flying"
})

-- Fly toggle
FlySection:AddToggle({
    Name = "Enable Fly",
    Default = false,
    Callback = function(Value)
        if Modules.AntiDetect and Modules.AntiDetect.SafeFly then
            -- Use anti-detect's safe fly
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                Modules.AntiDetect.SafeFly(Value, LocalPlayer.Character.HumanoidRootPart)
            end
        end
    end
})

-- No clip toggle
FlySection:AddToggle({
    Name = "No Clip",
    Default = false,
    Callback = function(Value)
        if Modules.AntiDetect and Modules.AntiDetect.SafeNoclip then
            Modules.AntiDetect.SafeNoclip(Value)
        end
    end
})

-- Create Misc Tab
local MiscTab = Window:MakeTab({
    Name = "Misc",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Teleport Section
local TeleportSection = MiscTab:AddSection({
    Name = "Teleport"
})

-- Teleport to random gun
TeleportSection:AddButton({
    Name = "TP to Random Gun",
    Callback = function()
        if Modules.Teleport and Modules.Teleport.TeleportToRandomWeapon then
            Modules.Teleport.TeleportToRandomWeapon()
        end
    end
})

-- Teleport to nearest player
TeleportSection:AddButton({
    Name = "TP to Nearest Enemy",
    Callback = function()
        if Modules.Teleport and Modules.Teleport.TeleportToNearestEnemy then
            Modules.Teleport.TeleportToNearestEnemy()
        end
    end
})

-- Anti Detect section
local AntiDetectSection = MiscTab:AddSection({
    Name = "Anti-Detection"
})

-- Toggle anti-detect
AntiDetectSection:AddToggle({
    Name = "Enable Anti-Detection",
    Default = true,
    Callback = function(Value)
        if Modules.AntiDetect then
            if Modules.AntiDetect.SetEnableDeadRailsBypass then
                Modules.AntiDetect.SetEnableDeadRailsBypass(Value)
            end
            if Modules.AntiDetect.SetEnableRemoteSpyProtection then
                Modules.AntiDetect.SetEnableRemoteSpyProtection(Value)
            end
        end
    end
})

-- Handle character respawning
LocalPlayer.CharacterAdded:Connect(function(character)
    -- Wait for humanoid
    local humanoid = character:WaitForChild("Humanoid")
    
    -- Reapply speed and jump power
    if _G.SelectedWalkSpeed then
        humanoid.WalkSpeed = _G.SelectedWalkSpeed
    end
    if _G.SelectedJumpPower then
        humanoid.JumpPower = _G.SelectedJumpPower
    end
end)

-- Initialize UI
OrionLib:Init()

-- Final notification
Notify("SkyX Hub", "Dead Rails loaded successfully!", 3)

-- Return completion message
return "SkyX Dead Rails loaded!"
